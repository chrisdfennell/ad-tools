{% extends 'base.html' %}
{% block title %}Search{% endblock %}

{% block breadcrumb %}
<a href="{{ url_for('dashboard.index') }}" class="text-decoration-none text-muted">Dashboard</a>
<span class="mx-2">/</span>
<span>Search</span>
{% endblock %}

{% block content %}
<div class="mb-4">
    <h4 class="mb-3"><i class="fas fa-search me-2"></i>Global Search</h4>
    <form method="GET" action="{{ url_for('search.index') }}" class="d-flex gap-2">
        <input type="text" name="q" class="form-control form-control-lg" placeholder="Search users, groups, computers, OUs..." value="{{ query }}" autofocus>
        <button type="submit" class="btn btn-primary btn-lg text-nowrap">
            <i class="fas fa-search me-1"></i>Search
        </button>
    </form>
</div>

{% if results %}
<p class="text-muted mb-4">Found <strong>{{ total }}</strong> result(s) for "<strong>{{ query }}</strong>"</p>

<!-- Users -->
{% if results.users %}
<div class="card mb-4">
    <div class="card-header">
        <i class="fas fa-users me-1"></i>Users <span class="badge bg-primary">{{ results.users|length }}</span>
    </div>
    <div class="card-body p-0">
        <table class="table table-hover mb-0">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Display Name</th>
                    <th>Email</th>
                    <th>Department</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for user in results.users %}
                <tr>
                    <td>
                        <a href="{{ url_for('users.detail', sam=user.sam) }}" class="fw-bold text-decoration-none">
                            {{ user.sam }}
                        </a>
                    </td>
                    <td>{{ user.display_name }}</td>
                    <td>{{ user.mail }}</td>
                    <td>{{ user.department }}</td>
                    <td>
                        {% if user.status == 'enabled' %}
                        <span class="badge badge-enabled">Enabled</span>
                        {% else %}
                        <span class="badge badge-disabled">Disabled</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<!-- Groups -->
{% if results.groups %}
<div class="card mb-4">
    <div class="card-header">
        <i class="fas fa-layer-group me-1"></i>Groups <span class="badge bg-success">{{ results.groups|length }}</span>
    </div>
    <div class="card-body p-0">
        <table class="table table-hover mb-0">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Members</th>
                </tr>
            </thead>
            <tbody>
                {% for group in results.groups %}
                <tr>
                    <td>
                        <a href="{{ url_for('groups.detail', cn=group.cn) }}" class="fw-bold text-decoration-none">
                            {{ group.cn }}
                        </a>
                    </td>
                    <td>{{ group.description }}</td>
                    <td><span class="badge bg-secondary">{{ group.member_count }}</span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<!-- Computers -->
{% if results.computers %}
<div class="card mb-4">
    <div class="card-header">
        <i class="fas fa-desktop me-1"></i>Computers <span class="badge bg-info">{{ results.computers|length }}</span>
    </div>
    <div class="card-body p-0">
        <table class="table table-hover mb-0">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>OS</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for comp in results.computers %}
                <tr>
                    <td>
                        <a href="{{ url_for('computers.detail', cn=comp.cn) }}" class="fw-bold text-decoration-none">
                            {{ comp.cn }}
                        </a>
                    </td>
                    <td>{{ comp.os }}</td>
                    <td>
                        {% if comp.status == 'enabled' %}
                        <span class="badge badge-enabled">Enabled</span>
                        {% else %}
                        <span class="badge badge-disabled">Disabled</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<!-- OUs -->
{% if results.ous %}
<div class="card mb-4">
    <div class="card-header">
        <i class="fas fa-sitemap me-1"></i>Organizational Units <span class="badge bg-warning text-dark">{{ results.ous|length }}</span>
    </div>
    <div class="card-body p-0">
        <table class="table table-hover mb-0">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>DN</th>
                </tr>
            </thead>
            <tbody>
                {% for ou in results.ous %}
                <tr>
                    <td>
                        <a href="{{ url_for('ous.tree') }}" class="fw-bold text-decoration-none">
                            {{ ou.name }}
                        </a>
                    </td>
                    <td>{{ ou.description }}</td>
                    <td><small class="text-muted">{{ ou.dn }}</small></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

{% if total == 0 %}
<div class="text-center text-muted py-5">
    <i class="fas fa-search fa-3x mb-3"></i>
    <p>No results found for "<strong>{{ query }}</strong>"</p>
</div>
{% endif %}

{% elif query %}
<div class="text-center text-muted py-5">
    <i class="fas fa-exclamation-triangle fa-3x mb-3 text-warning"></i>
    <p>Search failed. Please try again.</p>
</div>
{% else %}
<div class="text-center text-muted py-5">
    <i class="fas fa-search fa-3x mb-3"></i>
    <p>Enter a search term to find users, groups, computers, and OUs across Active Directory.</p>
</div>
{% endif %}
{% endblock %}
